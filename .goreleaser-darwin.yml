version: 2
builds:
  - id: zrok-amd64
    main: ./cmd/zrok
    binary: zrok2
    ldflags: "-s -w -X github.com/openziti/zrok/v2/build.Version={{.Tag}} -X github.com/openziti/zrok/v2/build.Hash={{.ShortCommit}}"
    env:
      - CGO_ENABLED=1
    goos:
      - darwin
    goarch:
      - amd64
    hooks:
      post:
        - cmd: 'codesign -s "Developer ID Application: NetFoundry Inc" -v dist/zrok-amd64_darwin_amd64_v1/zrok2 --options=runtime'
          output: true
        - cmd: zip "dist/zrok-amd64_darwin_amd64_v1/zrok2.zip" dist/zrok-amd64_darwin_amd64_v1/zrok2
        - cmd: xcrun notarytool submit "dist/zrok-amd64_darwin_amd64_v1/zrok2.zip" --apple-id {{ .Env.AC_USERNAME }} --password {{ .Env.AC_PASSWORD }} --team-id MN5S649TXM --wait
          output: true

  - id: zrok-arm64
    main: ./cmd/zrok
    binary: zrok2
    ldflags: "-s -w -X github.com/openziti/zrok/v2/build.Version={{.Tag}} -X github.com/openziti/zrok/v2/build.Hash={{.ShortCommit}}"
    env:
      - CGO_ENABLED=1
    goos:
      - darwin
    goarch:
      - arm64
    hooks:
      post:
        - cmd: 'codesign -s "Developer ID Application: NetFoundry Inc" -v dist/zrok-arm64_darwin_arm64_v8.0/zrok2 --options=runtime'
          output: true
        - cmd: zip "dist/zrok-arm64_darwin_arm64_v8.0/zrok2.zip" dist/zrok-arm64_darwin_arm64_v8.0/zrok2
        - cmd: xcrun notarytool submit "dist/zrok-arm64_darwin_arm64_v8.0/zrok2.zip" --apple-id {{ .Env.AC_USERNAME }} --password {{ .Env.AC_PASSWORD }} --team-id MN5S649TXM --wait
          output: true
