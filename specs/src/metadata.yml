/clientVersionCheck:
  post:
    tags:
      - metadata
    operationId: clientVersionCheck
    parameters:
      - name: body
        in: body
        schema:
          properties:
            clientVersion:
              type: string
    responses:
      200:
        description: compatible
      400:
        description: not compatible
        schema:
          type: string

/configuration:
  get:
    tags:
      - metadata
    operationId: configuration
    responses:
      200:
        description: current configuration
        schema:
          $ref: "#/definitions/configuration"

/detail/account:
  get:
    tags:
      - metadata
    security:
      - key: []
    operationId: getAccountDetail
    responses:
      200:
        description: ok
        schema:
          $ref: "#/definitions/environments"
      500:
        description: internal server error

/detail/environment/{envZId}:
  get:
    tags:
      - metadata
    security:
      - key: []
    operationId: getEnvironmentDetail
    parameters:
      - name: envZId
        in: path
        type: string
        required: true
    responses:
      200:
        description: ok
        schema:
          $ref: "#/definitions/environmentAndResources"
      401:
        description: unauthorized
      404:
        description: not found
      500:
        description: internal server error

/environments:
  get:
    tags:
      - metadata
    security:
      - key: []
    operationId: listEnvironments
    parameters:
      - name: description
        in: query
        type: string
        description: filter by description (case-insensitive substring match)
      - name: host
        in: query
        type: string
        description: filter by host (case-insensitive substring match)
      - name: address
        in: query
        type: string
        description: filter by address (exact match)
      - name: remoteAgent
        in: query
        type: boolean
        description: filter by whether agent is enrolled
      - name: hasShares
        in: query
        type: boolean
        description: filter by whether environment has active shares
      - name: hasAccesses
        in: query
        type: boolean
        description: filter by whether environment has active accesses
      - name: hasActivity
        in: query
        type: boolean
        description: filter by whether environment has metrics within activityDuration timeframe
      - name: idle
        in: query
        type: boolean
        description: filter environments WITHOUT recent activity (inverse of hasActivity)
      - name: shareCount
        in: query
        type: string
        description: filter by share count with operator (e.g., ">0", ">=5", "=0", "<10", "<=3")
      - name: accessCount
        in: query
        type: string
        description: filter by access count with operator (e.g., ">0", ">=5", "=0", "<10", "<=3")
      - name: createdAfter
        in: query
        type: string
        description: filter by created date (RFC3339 datetime, inclusive)
      - name: createdBefore
        in: query
        type: string
        description: filter by created date (RFC3339 datetime, inclusive)
      - name: updatedAfter
        in: query
        type: string
        description: filter by updated date (RFC3339 datetime, inclusive)
      - name: updatedBefore
        in: query
        type: string
        description: filter by updated date (RFC3339 datetime, inclusive)
      - name: activityDuration
        in: query
        type: string
        description: duration for hasActivity filter (e.g., "24h", "7d", "30d"). default "24h", maximum "30d" (720h)
    responses:
      200:
        description: list of environments
        schema:
          $ref: "#/definitions/environmentsList"
      400:
        description: bad request (e.g., activityDuration exceeds 30d, invalid date format, invalid operator)
        schema:
          $ref: "#/definitions/errorMessage"
      401:
        description: unauthorized
      500:
        description: internal server error
        schema:
          $ref: "#/definitions/errorMessage"

/shares:
  get:
    tags:
      - metadata
    security:
      - key: []
    operationId: listShares
    parameters:
      - name: envZId
        in: query
        type: string
        description: filter by environment ziti identity
      - name: shareMode
        in: query
        type: string
        description: filter by share mode (public/private)
      - name: backendMode
        in: query
        type: string
        description: filter by backend mode
      - name: shareToken
        in: query
        type: string
        description: filter by share token (substring match)
      - name: target
        in: query
        type: string
        description: filter by target (substring match)
      - name: permissionMode
        in: query
        type: string
        description: filter by permission mode (open/closed)
      - name: hasActivity
        in: query
        type: boolean
        description: filter shares with recent activity
      - name: idle
        in: query
        type: boolean
        description: filter shares WITHOUT recent activity (inverse of hasActivity)
      - name: activityDuration
        in: query
        type: string
        description: duration for hasActivity filter (e.g., "24h", "7d", "30d"). default "24h", maximum "30d" (720h)
      - name: createdAfter
        in: query
        type: string
        description: filter by created date (RFC3339 format)
      - name: createdBefore
        in: query
        type: string
        description: filter by created date (RFC3339 format)
      - name: updatedAfter
        in: query
        type: string
        description: filter by updated date (RFC3339 format)
      - name: updatedBefore
        in: query
        type: string
        description: filter by updated date (RFC3339 format)
    responses:
      200:
        description: list of shares
        schema:
          $ref: "#/definitions/sharesList"
      400:
        description: bad request (e.g., activityDuration exceeds 30d, invalid date format)
        schema:
          $ref: "#/definitions/errorMessage"
      401:
        description: unauthorized
      500:
        description: internal server error
        schema:
          $ref: "#/definitions/errorMessage"

/accesses:
  get:
    tags:
      - metadata
    security:
      - key: []
    operationId: listAccesses
    parameters:
      - name: envZId
        in: query
        type: string
        description: filter by environment ziti identity
      - name: shareToken
        in: query
        type: string
        description: filter by associated share token
      - name: bindAddress
        in: query
        type: string
        description: filter by bind address (substring match)
      - name: description
        in: query
        type: string
        description: filter by description (substring match)
      - name: createdAfter
        in: query
        type: string
        description: filter by created date (RFC3339 format)
      - name: createdBefore
        in: query
        type: string
        description: filter by created date (RFC3339 format)
      - name: updatedAfter
        in: query
        type: string
        description: filter by updated date (RFC3339 format)
      - name: updatedBefore
        in: query
        type: string
        description: filter by updated date (RFC3339 format)
    responses:
      200:
        description: list of accesses
        schema:
          $ref: "#/definitions/accessesList"
      400:
        description: bad request (e.g., activityDuration exceeds 30d, invalid date format)
        schema:
          $ref: "#/definitions/errorMessage"
      401:
        description: unauthorized
      500:
        description: internal server error
        schema:
          $ref: "#/definitions/errorMessage"

/detail/frontend/{frontendId}:
  get:
    tags:
      - metadata
    security:
      - key: []
    operationId: getFrontendDetail
    parameters:
      - name: frontendId
        in: path
        type: integer
        required: true
    responses:
      200:
        description: ok
        schema:
          $ref: "#/definitions/frontend"
      401:
        description: unauthorized
      404:
        description: not found
      500:
        description: internal server error

/detail/share/{shareToken}:
  get:
    tags:
      - metadata
    security:
      - key: []
    operationId: getShareDetail
    parameters:
      - name: shareToken
        in: path
        type: string
        required: true
    responses:
      200:
        description: ok
        schema:
          $ref: "#/definitions/share"
      401:
        description: unauthorized
      404:
        description: not found
      500:
        description: internal server error

/members/{organizationToken}:
  get:
    tags:
      - metadata
    security:
      - key: []
    operationId: listOrgMembers
    parameters:
        - name: organizationToken
          in: path
          type: string
          required: true
    responses:
      200:
        description: ok
        schema:
          properties:
            members:
              type: array
              items:
                properties:
                  email:
                    type: string
                  admin:
                    type: boolean
      404:
        description: not found
      500:
        description: internal server error

/memberships:
  get:
    tags:
      - metadata
    security:
      - key: []
    operationId: listMemberships
    responses:
      200:
        description: ok
        schema:
          properties:
            memberships:
              type: array
              items:
                properties:
                  organizationToken:
                    type: string
                  description:
                    type: string
                  admin:
                    type: boolean
      500:
        description: internal server error

/overview:
  get:
    tags:
      - metadata
    security:
      - key: []
    operationId: overview
    responses:
      200:
        description: overview returned
        schema:
          $ref: "#/definitions/overview"
      500:
        description: internal server error
        schema:
          $ref: "#/definitions/errorMessage"

/overview/{organizationToken}/{accountEmail}:
    get:
      tags:
        - metadata
      security:
        - key: []
      operationId: orgAccountOverview
      parameters:
        - name: organizationToken
          in: path
          type: string
          required: true
        - name: accountEmail
          in: path
          type: string
          required: true
      responses:
        200:
          description: ok
          schema:
            $ref: "#/definitions/overview"
        404:
          description: not found
        500:
          description: internal server error

/metrics/account:
  get:
    tags:
      - metadata
    security:
      - key: []
    operationId: getAccountMetrics
    parameters:
      - name: duration
        in: query
        type: string
    responses:
      200:
        description: account metrics
        schema:
          $ref: "#/definitions/metrics"
      400:
        description: bad request
      500:
        description: internal server error

/metrics/environment/{envId}:
  get:
    tags:
      - metadata
    security:
      - key: []
    operationId: getEnvironmentMetrics
    parameters:
      - name: envId
        in: path
        type: string
        required: true
      - name: duration
        in: query
        type: string
    responses:
      200:
        description: environment metrics
        schema:
          $ref: "#/definitions/metrics"
      400:
        description: bad request
      401:
        description: unauthorized
      500:
        description: internal server error


/metrics/share/{shareToken}:
  get:
    tags:
      - metadata
    security:
      - key: []
    operationId: getShareMetrics
    parameters:
      - name: shareToken
        in: path
        type: string
        required: true
      - name: duration
        in: query
        type: string
    responses:
      200:
        description: share metrics
        schema:
          $ref: "#/definitions/metrics"
      400:
        description: bad request
      401:
        description: unauthorized
      500:
        description: internal server error

/sparklines:
  post:
    tags:
      - metadata
    security:
      - key: []
    operationId: getSparklines
    parameters:
      - name: body
        in: body
        schema:
          properties:
            account:
              type: boolean
            environments:
              type: array
              items:
                type: string
            shares:
              type: array
              items:
                type: string
    responses:
      200:
        description: sparklines data
        schema:
          properties:
            sparklines:
              type: array
              items:
                $ref: "#/definitions/metrics"
      401:
        description: unauthorized
      500:
        description: internal server error

# deprecated (for legacy clients)
/version:
  get:
    tags:
      - metadata
    operationId: version
    responses:
      200:
        description: legacy upgrade required
        schema:
          $ref: "#/definitions/version"

/versions:
  get:
    tags:
      - metadata
    operationId: versionInventory
    responses:
      200:
        description: ok
        schema:
          properties:
            controllerVersion:
              type: string