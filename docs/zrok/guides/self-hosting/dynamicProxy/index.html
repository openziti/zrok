<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-zrok docs-version-current docs-doc-page docs-doc-id-guides/self-hosting/dynamicProxy" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Dynamic Proxy Frontend Migration Guide | zrok</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:url" content="https://docs.zrok.io/docs/zrok/guides/self-hosting/dynamicProxy/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" data-rh="true" name="nf-layout-version" content="0.1.1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-zrok-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-zrok-current"><meta data-rh="true" property="og:title" content="Dynamic Proxy Frontend Migration Guide | zrok"><meta data-rh="true" name="description" content="This guide helps self-hosting system administrators migrate from the legacy zrok access public (publicProxy) to the new v2.0 zrok access dynamicProxy (dynamicProxy) architecture. The dynamicProxy system provides enhanced scalability, namespace-based naming mapping, and full support for OAuth integration."><meta data-rh="true" property="og:description" content="This guide helps self-hosting system administrators migrate from the legacy zrok access public (publicProxy) to the new v2.0 zrok access dynamicProxy (dynamicProxy) architecture. The dynamicProxy system provides enhanced scalability, namespace-based naming mapping, and full support for OAuth integration."><link data-rh="true" rel="icon" href="/img/zrok-favicon.png"><link data-rh="true" rel="canonical" href="https://docs.zrok.io/docs/zrok/guides/self-hosting/dynamicProxy/"><link data-rh="true" rel="alternate" href="https://docs.zrok.io/docs/zrok/guides/self-hosting/dynamicProxy/" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.zrok.io/docs/zrok/guides/self-hosting/dynamicProxy/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Guides","item":"https://docs.zrok.io/docs/zrok/category/guides"},{"@type":"ListItem","position":2,"name":"Self Hosting","item":"https://docs.zrok.io/docs/zrok/category/self-hosting"},{"@type":"ListItem","position":3,"name":"Dynamic Proxy Frontend Migration Guide","item":"https://docs.zrok.io/docs/zrok/guides/self-hosting/dynamicProxy"}]}</script><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-MDFLZPK8"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-MDFLZPK8",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.f95dbfed.css">
<script src="/assets/js/runtime~main.58a4bd10.js" defer="defer"></script>
<script src="/assets/js/main.9afb8f4e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://zrok.io" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/zrok-1.0.0-rocket-green.svg" alt="zrok Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/zrok-1.0.0-rocket-green.svg" alt="zrok Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">zrok</b></a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/zrok/guides/self-hosting/dynamicProxy/">2.0 (Current)</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/zrok/guides/self-hosting/dynamicProxy/">2.0 (Current)</a></li><li><a class="dropdown__link" href="/docs/zrok/1.1/getting-started/">1.1</a></li><li><a class="dropdown__link" href="/docs/zrok/1.0/getting-started/">1.0</a></li></ul></div></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://zrok.io/pricing/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">pricing<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://myzrok.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">account<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://github.com/orgs/openziti/projects/16" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">roadmap<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://github.com/openziti/zrok" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" title="GitHub"></a><a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discourse-link" title="Discourse"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="starUsRoot_XOT4"><span style="color:whitesmoke">Star zrok on GitHub<!-- --> </span><span style="height:20px"><span><a href="https://github.com/openziti/zrok" data-icon="octicon-star" data-show-count="true" aria-label="Star buttons/github-buttons on GitHub">Star</a></span></span></div><div class="main-wrapper ozLayoutMainWrapper_GOGT"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/zrok/getting-started/"><span title="Getting Started" class="linkLabel_WmDU">Getting Started</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/zrok/concepts/"><span title="Concepts" class="categoryLinkLabel_W154">Concepts</span></a><button aria-label="Expand sidebar category &#x27;Concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/docs/zrok/category/guides/"><span title="Guides" class="categoryLinkLabel_W154">Guides</span></a><button aria-label="Collapse sidebar category &#x27;Guides&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zrok/guides/v2-migration-guide/"><span title="v2 Migration Guide" class="linkLabel_WmDU">v2 Migration Guide</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/zrok/guides/install/"><span title="Install" class="categoryLinkLabel_W154">Install</span></a><button aria-label="Expand sidebar category &#x27;Install&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/zrok/guides/agent/"><span title="The zrok Agent" class="categoryLinkLabel_W154">The zrok Agent</span></a><button aria-label="Expand sidebar category &#x27;The zrok Agent&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zrok/guides/frontdoor/"><span title="frontdoor" class="linkLabel_WmDU">frontdoor</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zrok/guides/permission-modes/"><span title="Permission Modes" class="linkLabel_WmDU">Permission Modes</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/zrok/guides/docker-share/"><span title="Docker Share" class="categoryLinkLabel_W154">Docker Share</span></a><button aria-label="Expand sidebar category &#x27;Docker Share&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/zrok/category/self-hosting/"><span title="Self Hosting" class="categoryLinkLabel_W154">Self Hosting</span></a><button aria-label="Collapse sidebar category &#x27;Self Hosting&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/zrok/guides/self-hosting/linux/"><span title="Linux" class="categoryLinkLabel_W154">Linux</span></a><button aria-label="Expand sidebar category &#x27;Linux&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zrok/guides/self-hosting/personalized-frontend/"><span title="Personalized Frontend" class="linkLabel_WmDU">Personalized Frontend</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zrok/guides/self-hosting/error-pages/"><span title="Error Pages" class="linkLabel_WmDU">Error Pages</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zrok/guides/self-hosting/interstitial-page/"><span title="Interstitial Pages" class="linkLabel_WmDU">Interstitial Pages</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/zrok/guides/self-hosting/dynamicProxy/"><span title="Dynamic Proxy Frontend Migration Guide" class="linkLabel_WmDU">Dynamic Proxy Frontend Migration Guide</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zrok/guides/self-hosting/organizations/"><span title="Organizations" class="linkLabel_WmDU">Organizations</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zrok/guides/self-hosting/docker/"><span title="Docker" class="linkLabel_WmDU">Docker</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zrok/guides/self-hosting/kubernetes/"><span title="Kubernetes" class="linkLabel_WmDU">Kubernetes</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/zrok/category/metrics-and-limits/"><span title="Metrics and Limits" class="categoryLinkLabel_W154">Metrics and Limits</span></a><button aria-label="Expand sidebar category &#x27;Metrics and Limits&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/zrok/category/oauth/"><span title="OAuth" class="categoryLinkLabel_W154">OAuth</span></a><button aria-label="Expand sidebar category &#x27;OAuth&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zrok/guides/self-hosting/instance-configuration/"><span title="Instance Config" class="linkLabel_WmDU">Instance Config</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zrok/guides/self-hosting/self-service-invite/"><span title="Invitations" class="linkLabel_WmDU">Invitations</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zrok/guides/drives/"><span title="Drives" class="linkLabel_WmDU">Drives</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zrok/guides/vpn/"><span title="VPN (Deprecated)" class="linkLabel_WmDU">VPN (Deprecated)</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/zrok/category/myzrok/"><span title="myzrok" class="categoryLinkLabel_W154">myzrok</span></a><button aria-label="Expand sidebar category &#x27;myzrok&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/zrok/category/guides/"><span>Guides</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/zrok/category/self-hosting/"><span>Self Hosting</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Dynamic Proxy Frontend Migration Guide</span></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 2.0 (Current)</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Dynamic Proxy Frontend Migration Guide</h1></header>
<p>This guide helps self-hosting system administrators migrate from the legacy <code>zrok access public</code> (<code>publicProxy</code>) to the new v2.0 <code>zrok access dynamicProxy</code> (<code>dynamicProxy</code>) architecture. The dynamicProxy system provides enhanced scalability, namespace-based naming mapping, and full support for OAuth integration.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="whats-changing">What&#x27;s Changing<a href="#whats-changing" class="hash-link" aria-label="Direct link to What&#x27;s Changing" title="Direct link to What&#x27;s Changing" translate="no">​</a></h3>
<p>In zrok v2.0, the public sharing model has been redesigned around <strong>namespaces</strong> and <strong>names</strong>:</p>
<ul>
<li class=""><strong>v1.x model</strong>: shares created with <code>zrok share public</code> or <code>zrok reserve public</code> connected directly to a public frontend</li>
<li class=""><strong>v2.0 model</strong>: shares use reserved or ephemeral <strong>names</strong> within <strong>namespaces</strong>, which are mapped to dynamic frontends</li>
</ul>
<p>The new <code>dynamicProxy</code> frontend replaces <code>publicProxy</code> with several key improvements:</p>
<ul>
<li class=""><strong>Namespace-based organization</strong>: logical grouping of names similar to DNS zones</li>
<li class=""><strong>Distributed mapping updates</strong>: AMQP-based real-time synchronization across multiple frontend instances</li>
<li class=""><strong>Enhanced scalability</strong>: multiple dynamicProxy instances can serve the same namespace</li>
<li class=""><strong>gRPC communication</strong>: efficient controller-to-frontend communication for mapping queries</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="architecture-components">Architecture Components<a href="#architecture-components" class="hash-link" aria-label="Direct link to Architecture Components" title="Direct link to Architecture Components" translate="no">​</a></h3>
<p>The dynamicProxy system consists of three main components:</p>
<ol>
<li class="">
<p><strong>dynamicProxyController</strong> (in zrok controller)</p>
<ul>
<li class="">gRPC service for mapping queries from frontends</li>
<li class="">AMQP publisher for broadcasting mapping updates</li>
<li class="">Manages the distribution of namespace/name to share mappings across your entire fleet of <code>dynamicProxy</code> instances</li>
</ul>
</li>
<li class="">
<p><strong>AMQP Message Broker</strong> (RabbitMQ)</p>
<ul>
<li class="">distributes mapping updates from controller to all frontend instances</li>
<li class="">enables real-time synchronization across distributed frontends</li>
<li class="">requires minimal configuration (topic exchange)</li>
</ul>
</li>
<li class="">
<p><strong>dynamicProxy Frontend</strong> (runs via <code>zrok access dynamicProxy</code>)</p>
<ul>
<li class="">HTTP/HTTPS listener serving dynamic share mappings</li>
<li class="">AMQP subscriber receiving mapping updates</li>
<li class="">gRPC client for initial mapping queries and on-demand lookups</li>
<li class="">optional OAuth integration for authentication</li>
</ul>
</li>
</ol>
<!-- -->
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites" translate="no">​</a></h2>
<p>Before setting up <code>dynamicProxy</code>, ensure you have:</p>
<ul>
<li class=""><strong>RabbitMQ</strong>: AMQP 0.9.1 compatible message broker (version 3.x or higher recommended)</li>
<li class=""><strong>Ziti Controller Access</strong>: administrative access to create identities, services, and policies</li>
<li class=""><strong>Running zrok Controller</strong>: v2.0 or higher with administrative credentials</li>
<li class=""><strong>DNS Configuration</strong>: ability to create DNS records for your frontend domain</li>
<li class=""><strong>TLS Certificates</strong>: for HTTPS frontends (Let&#x27;s Encrypt recommended)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="installing-rabbitmq">Installing RabbitMQ<a href="#installing-rabbitmq" class="hash-link" aria-label="Direct link to Installing RabbitMQ" title="Direct link to Installing RabbitMQ" translate="no">​</a></h3>
<p>RabbitMQ is available through most package managers. Here are installation options:</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="docker-recommended-for-testing">Docker (Recommended for Testing)<a href="#docker-recommended-for-testing" class="hash-link" aria-label="Direct link to Docker (Recommended for Testing)" title="Direct link to Docker (Recommended for Testing)" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker run -d --name rabbitmq \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -p 5672:5672 \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -p 15672:15672 \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  rabbitmq:3-management</span><br></span></code></pre></div></div>
<p>The management UI will be available at <code>http://localhost:15672</code> (default credentials: <code>guest</code>/<code>guest</code>).</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="ubuntudebian">Ubuntu/Debian<a href="#ubuntudebian" class="hash-link" aria-label="Direct link to Ubuntu/Debian" title="Direct link to Ubuntu/Debian" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt-get install rabbitmq-server</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl enable rabbitmq-server</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl start rabbitmq-server</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="rhelcentosfedora">RHEL/CentOS/Fedora<a href="#rhelcentosfedora" class="hash-link" aria-label="Direct link to RHEL/CentOS/Fedora" title="Direct link to RHEL/CentOS/Fedora" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo dnf install rabbitmq-server</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl enable rabbitmq-server</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl start rabbitmq-server</span><br></span></code></pre></div></div>
<p>For production deployments, consult the <a href="https://www.rabbitmq.com/download.html" target="_blank" rel="noopener noreferrer" class="">RabbitMQ documentation</a> for best practices on clustering, persistence, and monitoring.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="fresh-installation">Fresh Installation<a href="#fresh-installation" class="hash-link" aria-label="Direct link to Fresh Installation" title="Direct link to Fresh Installation" translate="no">​</a></h2>
<p>This section covers setting up dynamicProxy from scratch on a new zrok instance.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-1-create-dynamicproxycontroller-identity">Step 1: Create dynamicProxyController Identity<a href="#step-1-create-dynamicproxycontroller-identity" class="hash-link" aria-label="Direct link to Step 1: Create dynamicProxyController Identity" title="Direct link to Step 1: Create dynamicProxyController Identity" translate="no">​</a></h3>
<p>First, create a Ziti identity for the dynamicProxyController service:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 admin create identity dynamicProxyController</span><br></span></code></pre></div></div>
<p>This command outputs the identity details. Save the identity&#x27;s Ziti ID (starts with a letter, like <code>aBc123</code>), as you&#x27;ll need it for the next steps.</p>
<p>The identity configuration file is saved to <code>~/.zrok2/identities/dynamicProxyController.json</code> by default.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-2-create-ziti-service-and-policies">Step 2: Create Ziti Service and Policies<a href="#step-2-create-ziti-service-and-policies" class="hash-link" aria-label="Direct link to Step 2: Create Ziti Service and Policies" title="Direct link to Step 2: Create Ziti Service and Policies" translate="no">​</a></h3>
<p>Using the Ziti CLI, create a service for the dynamicProxyController and the necessary policies:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Set variables for convenience</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CONTROLLER_ZID=&quot;&lt;ziti-id-from-step-1&gt;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SERVICE_NAME=&quot;dynamicProxyController&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Create the service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ziti edge create service &quot;$SERVICE_NAME&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Create Service Edge Router Policy (allows edge routers to see the service)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ziti edge create serp &quot;${SERVICE_NAME}-serp&quot; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --edge-router-roles &#x27;#all&#x27; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --service-roles &quot;@${SERVICE_NAME}&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Create Service Policy for Bind (allows controller identity to bind the service)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ziti edge create sp &quot;${SERVICE_NAME}-bind&quot; Bind \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --identity-roles &quot;@${CONTROLLER_ZID}&quot; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --service-roles &quot;@${SERVICE_NAME}&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Create Service Policy for Dial (allows frontend to dial the service)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Note: Replace &#x27;public&#x27; with your frontend identity name if different</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ziti edge create sp &quot;${SERVICE_NAME}-dial&quot; Dial \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --identity-roles &quot;@public&quot; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --service-roles &quot;@${SERVICE_NAME}&quot;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The <code>public</code> identity referenced in the dial policy should be the identity used by your dynamicProxy frontends. If you use a different identity name, adjust the command accordingly. You can create multiple dial policies for different frontend identities if needed.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-3-configure-zrok-controller">Step 3: Configure zrok Controller<a href="#step-3-configure-zrok-controller" class="hash-link" aria-label="Direct link to Step 3: Configure zrok Controller" title="Direct link to Step 3: Configure zrok Controller" translate="no">​</a></h3>
<p>Add the dynamicProxyController configuration to your zrok controller configuration file (typically <code>etc/dev.yml</code> or your production config):</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Add to your existing controller configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">dynamic_proxy_controller</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">identity_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> /home/zrok/.zrok2/identities/dynamicProxyController.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">service_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> dynamicProxyController</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">amqp_publisher</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> amqp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">//guest</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">guest@localhost</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">5672</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">exchange_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> dynamicProxy</span><br></span></code></pre></div></div>
<p>Configuration parameters:</p>
<ul>
<li class=""><strong><code>identity_path</code></strong>: absolute path to the dynamicProxyController identity JSON file created in Step 1</li>
<li class=""><strong><code>service_name</code></strong>: name of the Ziti service created in Step 2 (must match)</li>
<li class=""><strong><code>amqp_publisher.url</code></strong>: AMQP connection URL for RabbitMQ (format: <code>amqp://username:password@host:port</code>)</li>
<li class=""><strong><code>amqp_publisher.exchange_name</code></strong>: AMQP exchange name for mapping updates (can be any name, must match frontend config)</li>
</ul>
<p>Restart your zrok controller to apply the configuration:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># If using systemd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl restart zrok-controller</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># If running manually</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Stop the controller (Ctrl+C) and restart it</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 controller etc/ctrl.yml</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-4-create-a-namespace">Step 4: Create a Namespace<a href="#step-4-create-a-namespace" class="hash-link" aria-label="Direct link to Step 4: Create a Namespace" title="Direct link to Step 4: Create a Namespace" translate="no">​</a></h3>
<p>Namespaces provide logical grouping for names. Create your first namespace:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Create an open namespace (anyone can create names in it)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 admin create namespace --token public --open zrok.example.com</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Or create a closed namespace (requires grants)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 admin create namespace --token private private.example.com</span><br></span></code></pre></div></div>
<p>The command outputs a namespace token (e.g., <code>abc123xyz</code>). Save this token as you&#x27;ll need it for frontend mapping and when creating names.</p>
<p>Parameters:</p>
<ul>
<li class=""><code>--token</code> specifies the namespace token used to refer to this specific namespace (the identifier)</li>
<li class=""><code>--open</code>: open mode (users can create names without grants); without <code>--open</code> is &quot;closed mode&quot; where users need explicit grants to create names in the namespace (use <code>zrok admin create namespace-grant</code>)</li>
<li class="">And the name (<code>zrok.example.com</code>) is the DNS name for the namespace; names will end up being <code>myshare.zrok.example.com</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-5-create-a-dynamic-frontend">Step 5: Create a Dynamic Frontend<a href="#step-5-create-a-dynamic-frontend" class="hash-link" aria-label="Direct link to Step 5: Create a Dynamic Frontend" title="Direct link to Step 5: Create a Dynamic Frontend" translate="no">​</a></h3>
<p>Create a frontend with the dynamic flag enabled:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 admin create frontend --dynamic public &quot;http://{token}.zrok.example.com:8080&quot;</span><br></span></code></pre></div></div>
<p>This creates a dynamic frontend and outputs a frontend token (e.g., <code>KMmfE0VXO7Pp</code>).</p>
<p>Command breakdown:</p>
<ul>
<li class=""><strong><code>--dynamic</code></strong>: enables dynamic mode (required for dynamicProxy)</li>
<li class=""><strong><code>public</code></strong>: Ziti identity that will bind the frontend (must have dial permissions to dynamicProxyController service)</li>
<li class=""><strong><code>&quot;http://{token}.zrok.example.com:8080&quot;</code></strong>: URL template for shares<!-- -->
<ul>
<li class="">This is the legacy URL template used with legacy <code>publicProxy</code> frontends; disregarded by new v2 <code>dynamicProxy</code> installations and will be removed in future versions of zrok</li>
<li class=""><code>{token}</code> is replaced with the share token or name</li>
<li class="">can use <code>https</code> if you configure TLS in the frontend config</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-6-map-namespace-to-frontend">Step 6: Map Namespace to Frontend<a href="#step-6-map-namespace-to-frontend" class="hash-link" aria-label="Direct link to Step 6: Map Namespace to Frontend" title="Direct link to Step 6: Map Namespace to Frontend" translate="no">​</a></h3>
<p>Link the namespace to the frontend so shares in the namespace are served by this frontend:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 admin create namespace-frontend &lt;namespaceToken&gt; &lt;frontendToken&gt;</span><br></span></code></pre></div></div>
<p>You can map multiple frontends to a single namespace for load balancing and high availability. All mapped frontends will receive the same mapping updates via AMQP.</p>
<p>For simple horizontal scalability (behind a load balancer) you can create one logical frontend in the zrok controller, and share the frontendToken and identity amongst multiple <code>zrok access dynamicProxy</code> instances</p>
<p>To view existing mappings:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># List frontends for a namespace</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 admin list namespaceFrontendMappings &lt;namespaceToken&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># List namespaces for a frontend</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 admin list frontendNamespaceMappings &lt;frontendToken&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-7-configure-dynamicproxy-frontend">Step 7: Configure dynamicProxy Frontend<a href="#step-7-configure-dynamicproxy-frontend" class="hash-link" aria-label="Direct link to Step 7: Configure dynamicProxy Frontend" title="Direct link to Step 7: Configure dynamicProxy Frontend" translate="no">​</a></h3>
<p>Create a configuration file for the dynamicProxy frontend (e.g., <code>etc/dynamicProxy.yml</code>):</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">frontend_token</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> &lt;frontendToken</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">from</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">step</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">identity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> public</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">bind_address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0.0.0.0:8080&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">mapping_refresh_interval</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 1m</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">amqp_subscriber</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> amqp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">//guest</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">guest@localhost</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">5672</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">exchange_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> dynamicProxy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">controller</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">identity_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> /home/zrok/.zrok2/identities/public.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">service_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> dynamicProxyController</span><br></span></code></pre></div></div>
<p>Configuration parameters:</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="required-parameters">Required Parameters<a href="#required-parameters" class="hash-link" aria-label="Direct link to Required Parameters" title="Direct link to Required Parameters" translate="no">​</a></h4>
<ul>
<li class=""><strong><code>v</code></strong>: configuration version (always <code>1</code>)</li>
<li class=""><strong><code>frontend_token</code></strong>: token from <code>zrok admin create frontend</code> (Step 5)</li>
<li class=""><strong><code>amqp_subscriber.url</code></strong>: RabbitMQ connection URL (must match controller&#x27;s <code>amqp_publisher.url</code>)</li>
<li class=""><strong><code>amqp_subscriber.exchange_name</code></strong>: AMQP exchange name (must match controller&#x27;s <code>amqp_publisher.exchange_name</code>)</li>
<li class=""><strong><code>controller.identity_path</code></strong>: path to the Ziti identity JSON file for the frontend</li>
<li class=""><strong><code>controller.service_name</code></strong>: Ziti service name for dynamicProxyController (must match Step 2 and controller config)</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="optional-parameters">Optional Parameters<a href="#optional-parameters" class="hash-link" aria-label="Direct link to Optional Parameters" title="Direct link to Optional Parameters" translate="no">​</a></h4>
<ul>
<li class=""><strong><code>identity</code></strong>: Ziti identity name to use (default: <code>&quot;public&quot;</code>)</li>
<li class=""><strong><code>bind_address</code></strong>: IP and port where the frontend listens (default: <code>&quot;0.0.0.0:8080&quot;</code>)</li>
<li class=""><strong><code>mapping_refresh_interval</code></strong>: how often to audit (and potentially refresh) mappings from controller (default: <code>5m</code>)</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="oauth-configuration-optional">OAuth Configuration (Optional)<a href="#oauth-configuration-optional" class="hash-link" aria-label="Direct link to OAuth Configuration (Optional)" title="Direct link to OAuth Configuration (Optional)" translate="no">​</a></h4>
<p>To enable OAuth authentication, add an <code>oauth</code> section. For detailed OAuth setup, see the <a class="" href="/docs/zrok/guides/self-hosting/oauth/configuring-oauth/">OAuth Configuration Guide</a>.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">oauth</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">bind_address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0.0.0.0:8181&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">endpoint_url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://oauth.zrok.example.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">cookie_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;zrok-auth-session&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">cookie_domain</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;zrok.example.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">session_lifetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;6h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">intermediate_lifetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;5m&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">signing_key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;your-unique-signing-key-32-chars-min&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">encryption_key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;your-unique-encryption-key-24-chars-min&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">providers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;google&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;google&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">client_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&lt;google-client-id&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">client_secret</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&lt;google-client-secret&gt;&quot;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="tls-configuration-optional">TLS Configuration (Optional)<a href="#tls-configuration-optional" class="hash-link" aria-label="Direct link to TLS Configuration (Optional)" title="Direct link to TLS Configuration (Optional)" translate="no">​</a></h4>
<p>For HTTPS frontends, add a <code>tls</code> section:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">tls</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">cert_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> /etc/letsencrypt/live/zrok.example.com/fullchain.pem</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">key_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> /etc/letsencrypt/live/zrok.example.com/privkey.pem</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-8-start-dynamicproxy-frontend">Step 8: Start dynamicProxy Frontend<a href="#step-8-start-dynamicproxy-frontend" class="hash-link" aria-label="Direct link to Step 8: Start dynamicProxy Frontend" title="Direct link to Step 8: Start dynamicProxy Frontend" translate="no">​</a></h3>
<p>Run the dynamicProxy frontend using your configuration:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 access dynamicProxy etc/dynamicProxy.yml</span><br></span></code></pre></div></div>
<p>The frontend will:</p>
<ol>
<li class="">Connect to the Ziti network using the configured identity</li>
<li class="">Subscribe to the AMQP exchange for mapping updates</li>
<li class="">Query the controller via gRPC for initial mappings</li>
<li class="">Start serving HTTP/HTTPS traffic on the configured bind address</li>
</ol>
<p>For production deployments, consider using a process manager like systemd:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># /etc/systemd/system/zrok-dynamicproxy.service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[Unit]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Description=zrok Dynamic Proxy Frontend</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">After=network.target rabbitmq-server.service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[Service]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Type=simple</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">User=zrok</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Group=zrok</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WorkingDirectory=/home/zrok</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ExecStart=/usr/local/bin/zrok2 access dynamicProxy /home/zrok/etc/dynamicProxy.yml</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Restart=always</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RestartSec=10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[Install]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WantedBy=multi-user.target</span><br></span></code></pre></div></div>
<p>Enable and start the service:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl enable zrok-dynamicproxy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl start zrok-dynamicproxy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl status zrok-dynamicproxy</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-9-test-with-a-share">Step 9: Test with a Share<a href="#step-9-test-with-a-share" class="hash-link" aria-label="Direct link to Step 9: Test with a Share" title="Direct link to Step 9: Test with a Share" translate="no">​</a></h3>
<p>Create a test share to verify the setup:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># First, enable a zrok environment if you haven&#x27;t already</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 enable &lt;accountToken&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Set the default namespace for convenience</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 config set defaultNamespace &lt;namespaceToken&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Create a reserved name in the namespace</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 create name -n &lt;namespaceToken&gt; my-test-share</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Share a resource using the reserved name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 share public --backend-mode web -n &lt;namespaceToken&gt;:my-test-share ~/public</span><br></span></code></pre></div></div>
<p>Access your share at <code>http://my-test-share.zrok.example.com:8080</code> (adjust domain/port based on your configuration).</p>
<p>If you see your shared content, congratulations! Your dynamicProxy setup is working correctly.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="migrating-from-publicproxy">Migrating from publicProxy<a href="#migrating-from-publicproxy" class="hash-link" aria-label="Direct link to Migrating from publicProxy" title="Direct link to Migrating from publicProxy" translate="no">​</a></h2>
<p>If you&#x27;re currently running <code>zrok access public</code> (publicProxy) and want to migrate to dynamicProxy, you have two main approaches:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="option-1-side-by-side-operation-gradual-migration">Option 1: Side-by-Side Operation (Gradual Migration)<a href="#option-1-side-by-side-operation-gradual-migration" class="hash-link" aria-label="Direct link to Option 1: Side-by-Side Operation (Gradual Migration)" title="Direct link to Option 1: Side-by-Side Operation (Gradual Migration)" translate="no">​</a></h3>
<p>This approach allows both publicProxy and dynamicProxy to run simultaneously, enabling gradual user migration with no downtime.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="setup-process">Setup Process<a href="#setup-process" class="hash-link" aria-label="Direct link to Setup Process" title="Direct link to Setup Process" translate="no">​</a></h4>
<ol>
<li class=""><strong>Complete Steps 1-8</strong> from the Fresh Installation section without shutting down your existing publicProxy</li>
<li class=""><strong>Create separate DNS entries</strong> for the new dynamicProxy frontend (e.g., <code>v2.zrok.example.com</code>)</li>
<li class=""><strong>Communicate the migration</strong> to your users:<!-- -->
<ul>
<li class="">users on v1.x clients can continue using the old publicProxy</li>
<li class="">users on v2.0+ clients can start using namespaces and names with dynamicProxy</li>
<li class="">provide a migration deadline</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="user-migration-process">User Migration Process<a href="#user-migration-process" class="hash-link" aria-label="Direct link to User Migration Process" title="Direct link to User Migration Process" translate="no">​</a></h4>
<p>Users need to:</p>
<ol>
<li class="">Upgrade to zrok v2.0+</li>
<li class="">Set the default namespace: <code>zrok2 config set defaultNamespace &lt;namespaceToken&gt;</code></li>
<li class="">Recreate their shares using names:<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Instead of: zrok2 reserve public 8080</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># They use:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 create name my-app</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 share public localhost:8080 -n &lt;namespaceToken&gt;:my-app</span><br></span></code></pre></div></div>
</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="deprecation-timeline">Deprecation Timeline<a href="#deprecation-timeline" class="hash-link" aria-label="Direct link to Deprecation Timeline" title="Direct link to Deprecation Timeline" translate="no">​</a></h4>
<p>Once user adoption reaches your target threshold:</p>
<ol>
<li class="">Announce the publicProxy shutdown date (recommend 30+ days notice)</li>
<li class="">Monitor publicProxy usage via controller metrics</li>
<li class="">Contact remaining users directly if possible</li>
<li class="">Shut down publicProxy and remove DNS entries</li>
<li class="">Update documentation to remove v1.x references</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="option-2-clean-cutover-with-downtime">Option 2: Clean Cutover (With Downtime)<a href="#option-2-clean-cutover-with-downtime" class="hash-link" aria-label="Direct link to Option 2: Clean Cutover (With Downtime)" title="Direct link to Option 2: Clean Cutover (With Downtime)" translate="no">​</a></h3>
<p>This approach requires downtime but provides a clean migration in a single maintenance window.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="preparation-before-maintenance-window">Preparation (Before Maintenance Window)<a href="#preparation-before-maintenance-window" class="hash-link" aria-label="Direct link to Preparation (Before Maintenance Window)" title="Direct link to Preparation (Before Maintenance Window)" translate="no">​</a></h4>
<ol>
<li class=""><strong>Complete Steps 1-7</strong> from the Fresh Installation section</li>
<li class=""><strong>Test dynamicProxy configuration</strong> thoroughly in a staging environment</li>
<li class=""><strong>Notify all users</strong> of the scheduled maintenance window</li>
<li class=""><strong>Prepare migration documentation</strong> for users</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="during-maintenance-window">During Maintenance Window<a href="#during-maintenance-window" class="hash-link" aria-label="Direct link to During Maintenance Window" title="Direct link to During Maintenance Window" translate="no">​</a></h4>
<ol>
<li class=""><strong>Shut down publicProxy</strong> (<code>zrok access public</code> processes)</li>
<li class=""><strong>Start dynamicProxy</strong> with the same DNS entries as the old publicProxy</li>
<li class=""><strong>Notify users</strong> to upgrade to v2.0+ and recreate their shares using names</li>
<li class=""><strong>Provide support channels</strong> for migration assistance</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="post-migration">Post-Migration<a href="#post-migration" class="hash-link" aria-label="Direct link to Post-Migration" title="Direct link to Post-Migration" translate="no">​</a></h4>
<p>All users must:</p>
<ol>
<li class="">Upgrade to zrok v2.0+</li>
<li class="">Set default namespace: <code>zrok2 config set defaultNamespace &lt;namespaceToken&gt;</code></li>
<li class="">Recreate shares as shown in Option 1</li>
</ol>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Clean cutover means existing v1.x shares will stop working immediately. Only choose this approach if you can ensure all users upgrade and recreate their shares promptly, or if downtime is acceptable.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="comparing-migration-approaches">Comparing Migration Approaches<a href="#comparing-migration-approaches" class="hash-link" aria-label="Direct link to Comparing Migration Approaches" title="Direct link to Comparing Migration Approaches" translate="no">​</a></h3>
<table><thead><tr><th>Aspect</th><th>Side-by-Side</th><th>Clean Cutover</th></tr></thead><tbody><tr><td><strong>Downtime</strong></td><td>None</td><td>Required</td></tr><tr><td><strong>Complexity</strong></td><td>Higher (manage two systems)</td><td>Lower (single system)</td></tr><tr><td><strong>User Impact</strong></td><td>Gradual, self-paced</td><td>Immediate, forced</td></tr><tr><td><strong>Resource Usage</strong></td><td>Higher (duplicate frontends)</td><td>Lower (single frontend)</td></tr><tr><td><strong>Rollback</strong></td><td>Easy (keep publicProxy)</td><td>Difficult</td></tr><tr><td><strong>Timeline</strong></td><td>Weeks to months</td><td>Single maintenance window</td></tr></tbody></table>
<p>Choose side-by-side for larger deployments with diverse users, or clean cutover for smaller deployments with coordinated users.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuration-reference">Configuration Reference<a href="#configuration-reference" class="hash-link" aria-label="Direct link to Configuration Reference" title="Direct link to Configuration Reference" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="complete-configuration-example">Complete Configuration Example<a href="#complete-configuration-example" class="hash-link" aria-label="Direct link to Complete Configuration Example" title="Direct link to Complete Configuration Example" translate="no">​</a></h3>
<p>Here&#x27;s a complete <code>dynamicProxy</code> configuration with all available options:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Frontend identification</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">frontend_token</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> KMmfE0VXO7Pp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">identity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> public</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">bind_address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0.0.0.0:8080&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Mapping refresh interval</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">mapping_refresh_interval</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 1m</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># AMQP subscriber for receiving mapping updates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">amqp_subscriber</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> amqp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">//guest</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">guest@localhost</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">5672</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">exchange_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> dynamicProxy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">queue_depth</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">1024</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># Optional: buffer size for mapping updates (default: 1024)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Controller client for gRPC queries</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">controller</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">identity_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> /home/zrok/.zrok2/identities/public.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">service_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> dynamicProxyController</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">timeout</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 30s  </span><span class="token comment" style="color:rgb(98, 114, 164)"># Optional: gRPC request timeout (default: 30s)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Optional: TLS configuration for HTTPS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">tls</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">cert_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> /etc/letsencrypt/live/zrok.example.com/fullchain.pem</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">key_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> /etc/letsencrypt/live/zrok.example.com/privkey.pem</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Optional: Interstitial page configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">interstitial</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">html_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> /etc/zrok/interstitial.html</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">user_agent_prefixes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Mozilla/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Chrome/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Optional: OAuth configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">oauth</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">bind_address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;127.0.0.1:8181&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">endpoint_url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://oauth.zrok.example.com:8443&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">cookie_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;zrok-auth-session&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">cookie_domain</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;zrok.example.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">session_lifetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;6h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">intermediate_lifetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;5m&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">signing_key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;your-32-plus-character-signing-key-here&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">encryption_key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;your-24-plus-character-encryption-key-here&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">max_cookie_size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">3072</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># Optional: maximum cookie size in bytes (default: 3072)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">providers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Google OAuth</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;google&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;google&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">client_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;your-google-client-id&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">client_secret</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;your-google-client-secret&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># GitHub OAuth</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;github&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;github&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">client_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;your-github-client-id&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">client_secret</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;your-github-client-secret&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Generic OIDC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;microsoft&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;oidc&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">client_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;your-oidc-client-id&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">client_secret</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;your-oidc-client-secret&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">scopes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;openid&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;email&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;profile&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">issuer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://login.microsoftonline.com/&lt;tenant-id&gt;/v2.0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">supports_pkce</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><br></span></code></pre></div></div>
<p>For detailed OAuth provider configuration, see the <a class="" href="/docs/zrok/guides/self-hosting/oauth/configuring-oauth/">OAuth Configuration Guide</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="namespace-management">Namespace Management<a href="#namespace-management" class="hash-link" aria-label="Direct link to Namespace Management" title="Direct link to Namespace Management" translate="no">​</a></h2>
<p>After setting up dynamicProxy, you&#x27;ll need to manage namespaces and names for your users.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="creating-namespaces">Creating Namespaces<a href="#creating-namespaces" class="hash-link" aria-label="Direct link to Creating Namespaces" title="Direct link to Creating Namespaces" translate="no">​</a></h3>
<p>Namespaces can be <strong>open</strong> (anyone can create names) or <strong>closed</strong> (requires grants):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Open namespace - users can freely create names</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 admin create namespace public &quot;Public Shares&quot; -o</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Closed namespace - requires explicit grants</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 admin create namespace private &quot;Private Shares&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="granting-namespace-access">Granting Namespace Access<a href="#granting-namespace-access" class="hash-link" aria-label="Direct link to Granting Namespace Access" title="Direct link to Granting Namespace Access" translate="no">​</a></h3>
<p>For closed namespaces, grant users access by email:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 admin add namespaceGrant &lt;namespaceToken&gt; user@example.com</span><br></span></code></pre></div></div>
<p>Remove grants with:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 admin remove namespaceGrant &lt;namespaceToken&gt; user@example.com</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="setting-default-namespace">Setting Default Namespace<a href="#setting-default-namespace" class="hash-link" aria-label="Direct link to Setting Default Namespace" title="Direct link to Setting Default Namespace" translate="no">​</a></h3>
<p>Users can set their default namespace to avoid specifying it on every command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 config set defaultNamespace &lt;namespaceToken&gt;</span><br></span></code></pre></div></div>
<p>Or via environment variable:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">export ZROK2_DEFAULT_NAMESPACE=&lt;namespaceToken&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="listing-namespaces">Listing Namespaces<a href="#listing-namespaces" class="hash-link" aria-label="Direct link to Listing Namespaces" title="Direct link to Listing Namespaces" translate="no">​</a></h3>
<p>Users can see available namespaces (based on grants and open namespaces):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 list namespaces</span><br></span></code></pre></div></div>
<p>Administrators can list all namespaces:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 admin list namespaces</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="frontend-not-receiving-mapping-updates">Frontend Not Receiving Mapping Updates<a href="#frontend-not-receiving-mapping-updates" class="hash-link" aria-label="Direct link to Frontend Not Receiving Mapping Updates" title="Direct link to Frontend Not Receiving Mapping Updates" translate="no">​</a></h3>
<p><strong>Symptoms</strong>: shares are created but don&#x27;t resolve, frontend logs show no mapping updates</p>
<p><strong>Diagnostics</strong>:</p>
<ol>
<li class="">
<p>Verify AMQP connectivity:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Test RabbitMQ connection</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">curl -u guest:guest http://localhost:15672/api/overview</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Check if exchange exists</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">curl -u guest:guest http://localhost:15672/api/exchanges/%2F/dynamicProxy</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Check controller logs for AMQP publisher errors:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># If using systemd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo journalctl -u zrok-controller -f</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Verify frontend logs for AMQP subscriber connection:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># If using systemd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo journalctl -u zrok-dynamicproxy -f</span><br></span></code></pre></div></div>
</li>
</ol>
<p><strong>Solutions</strong>:</p>
<ul>
<li class="">Ensure <code>exchange_name</code> matches in both controller and frontend configs</li>
<li class="">Verify RabbitMQ is running and accessible from both controller and frontend hosts</li>
<li class="">Check firewall rules if RabbitMQ is on a separate host</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="frontend-cannot-query-controller-via-grpc">Frontend Cannot Query Controller via gRPC<a href="#frontend-cannot-query-controller-via-grpc" class="hash-link" aria-label="Direct link to Frontend Cannot Query Controller via gRPC" title="Direct link to Frontend Cannot Query Controller via gRPC" translate="no">​</a></h3>
<p><strong>Symptoms</strong>: frontend starts but shows errors querying mappings, shares don&#x27;t resolve</p>
<p><strong>Diagnostics</strong>:</p>
<ol>
<li class="">
<p>Verify Ziti connectivity:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Test if frontend can reach dynamicProxyController service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ziti edge list services --name dynamicProxyController</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Check service policies:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Verify bind policy exists</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ziti edge list service-policies --name dynamicProxyController-bind</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Verify dial policy exists for frontend identity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ziti edge list service-policies --name dynamicProxyController-dial</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Check controller logs for gRPC server errors:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo journalctl -u zrok-controller | grep -i grpc</span><br></span></code></pre></div></div>
</li>
</ol>
<p><strong>Solutions</strong>:</p>
<ul>
<li class="">Ensure <code>service_name</code> matches in controller config, frontend config, and Ziti service name</li>
<li class="">Verify the frontend identity has dial permissions (Step 2)</li>
<li class="">Confirm controller identity has bind permissions (Step 2)</li>
<li class="">Check that both identities are enrolled and connected to Ziti</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="shares-dont-resolve-404-errors">Shares Don&#x27;t Resolve (404 Errors)<a href="#shares-dont-resolve-404-errors" class="hash-link" aria-label="Direct link to Shares Don&#x27;t Resolve (404 Errors)" title="Direct link to Shares Don&#x27;t Resolve (404 Errors)" translate="no">​</a></h3>
<p><strong>Symptoms</strong>: accessing <code>http://&lt;name&gt;.zrok.example.com</code> returns 404</p>
<p><strong>Diagnostics</strong>:</p>
<ol>
<li class="">
<p>Verify namespace-to-frontend mapping exists:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 admin list namespace-frontend &lt;namespaceToken&gt;</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Check if the name exists:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 list names</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Verify the share is active:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 list shares</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Check frontend logs for mapping presence:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo journalctl -u zrok-dynamicproxy -f</span><br></span></code></pre></div></div>
</li>
</ol>
<p><strong>Solutions</strong>:</p>
<ul>
<li class="">Create namespace-to-frontend mapping if missing (Step 6)</li>
<li class="">Verify the share is using the correct namespace token</li>
<li class="">Restart the share if it was created before the mapping</li>
<li class="">Check that the frontend token in config matches the frontend created in Step 5</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="dns-not-resolving">DNS Not Resolving<a href="#dns-not-resolving" class="hash-link" aria-label="Direct link to DNS Not Resolving" title="Direct link to DNS Not Resolving" translate="no">​</a></h3>
<p><strong>Symptoms</strong>: domain names don&#x27;t resolve or resolve to wrong IP</p>
<p><strong>Diagnostics</strong>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Test DNS resolution</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dig my-share.zrok.example.com</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Check if DNS propagates correctly</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nslookup my-share.zrok.example.com</span><br></span></code></pre></div></div>
<p><strong>Solutions</strong>:</p>
<ul>
<li class="">Ensure wildcard DNS record exists: <code>*.zrok.example.com -&gt; &lt;frontend-ip&gt;</code></li>
<li class="">Wait for DNS propagation (can take minutes to hours)</li>
<li class="">Use <code>/etc/hosts</code> for local testing: <code>127.0.0.1 my-share.zrok.example.com</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="tls-certificate-errors">TLS Certificate Errors<a href="#tls-certificate-errors" class="hash-link" aria-label="Direct link to TLS Certificate Errors" title="Direct link to TLS Certificate Errors" translate="no">​</a></h3>
<p><strong>Symptoms</strong>: browser shows certificate warnings, HTTPS connections fail</p>
<p><strong>Solutions</strong>:</p>
<ul>
<li class="">Use a wildcard certificate for <code>*.zrok.example.com</code></li>
<li class="">Verify certificate paths in <code>tls</code> configuration are correct and readable</li>
<li class="">For Let&#x27;s Encrypt, use DNS challenge for wildcard certificates:<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">certbot certonly --manual --preferred-challenges dns \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -d &#x27;*.zrok.example.com&#x27; -d &#x27;zrok.example.com&#x27;</span><br></span></code></pre></div></div>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="high-memory-usage">High Memory Usage<a href="#high-memory-usage" class="hash-link" aria-label="Direct link to High Memory Usage" title="Direct link to High Memory Usage" translate="no">​</a></h3>
<p><strong>Symptoms</strong>: dynamicProxy or controller consuming excessive memory</p>
<p><strong>Diagnostics</strong>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Check memory usage</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ps aux | grep zrok</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Monitor AMQP queue depth</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">curl -u guest:guest http://localhost:15672/api/queues/%2F/&lt;queue-name&gt;</span><br></span></code></pre></div></div>
<p><strong>Solutions</strong>:</p>
<ul>
<li class="">Reduce <code>mapping_refresh_interval</code> if it&#x27;s too frequent</li>
<li class="">Adjust <code>queue_depth</code> in AMQP subscriber config</li>
<li class="">Consider multiple frontend instances with load balancing instead of increasing resources</li>
<li class="">Monitor and limit the number of active shares per namespace</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="advanced-configuration">Advanced Configuration<a href="#advanced-configuration" class="hash-link" aria-label="Direct link to Advanced Configuration" title="Direct link to Advanced Configuration" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="multiple-frontend-instances">Multiple Frontend Instances<a href="#multiple-frontend-instances" class="hash-link" aria-label="Direct link to Multiple Frontend Instances" title="Direct link to Multiple Frontend Instances" translate="no">​</a></h3>
<p>For high availability and load balancing, run multiple dynamicProxy instances:</p>
<ol>
<li class="">Create separate configuration files for each instance (with unique bind addresses if on the same host)</li>
<li class="">Map the same namespace to multiple frontends:<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 admin create namespace-frontend &lt;namespaceToken&gt; &lt;frontendToken1&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">zrok2 admin create namesapce-frontend &lt;namespaceToken&gt; &lt;frontendToken2&gt;</span><br></span></code></pre></div></div>
</li>
<li class="">Use a load balancer (nginx, HAProxy, etc.) in front of the instances</li>
<li class="">Each instance will receive mapping updates via AMQP independently</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="custom-exchange-names">Custom Exchange Names<a href="#custom-exchange-names" class="hash-link" aria-label="Direct link to Custom Exchange Names" title="Direct link to Custom Exchange Names" translate="no">​</a></h3>
<p>You can use different AMQP exchange names for different frontend groups:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Controller config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">dynamic_proxy_controller</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">amqp_publisher</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">exchange_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> dynamicProxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">prod</span><br></span></code></pre></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Frontend config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">amqp_subscriber</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">exchange_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> dynamicProxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">prod</span><br></span></code></pre></div></div>
<p>This allows you to isolate mapping updates between different deployment environments (prod, staging, etc.).</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="monitoring-and-metrics">Monitoring and Metrics<a href="#monitoring-and-metrics" class="hash-link" aria-label="Direct link to Monitoring and Metrics" title="Direct link to Monitoring and Metrics" translate="no">​</a></h3>
<p>Integrate with your monitoring stack:</p>
<ol>
<li class=""><strong>RabbitMQ metrics</strong>: Use the management plugin to monitor queue depth, message rates, and connections</li>
<li class=""><strong>zrok controller metrics</strong>: if you&#x27;ve configured InfluxDB metrics (see <a class="" href="/docs/zrok/guides/self-hosting/metrics-and-limits/configuring-metrics/">Configuring Metrics</a>), monitor:<!-- -->
<ul>
<li class="">Frontend registration count</li>
<li class="">Mapping update frequency</li>
<li class="">gRPC request latency</li>
</ul>
</li>
<li class=""><strong>Frontend logs</strong>: parse structured logs for error rates and performance data</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="additional-resources">Additional Resources<a href="#additional-resources" class="hash-link" aria-label="Direct link to Additional Resources" title="Direct link to Additional Resources" translate="no">​</a></h2>
<ul>
<li class=""><a class="" href="/docs/zrok/guides/self-hosting/oauth/configuring-oauth/">OAuth Configuration Guide</a> - detailed OAuth provider setup</li>
<li class=""><a class="" href="/docs/zrok/guides/self-hosting/metrics-and-limits/configuring-metrics/">Configuring Metrics</a> - InfluxDB integration for monitoring</li>
<li class=""><a class="" href="/docs/zrok/guides/self-hosting/interstitial-page/">Interstitial Page Configuration</a> - customizing the interstitial page</li>
<li class=""><a class="" href="/docs/zrok/guides/self-hosting/error-pages/">Error Pages</a> - customizing error pages</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="getting-help">Getting Help<a href="#getting-help" class="hash-link" aria-label="Direct link to Getting Help" title="Direct link to Getting Help" translate="no">​</a></h2>
<p>If you encounter issues not covered in this guide:</p>
<ol>
<li class="">Check the <a href="https://github.com/openziti/zrok/issues" target="_blank" rel="noopener noreferrer" class="">zrok GitHub Issues</a> for similar problems</li>
<li class="">Enable verbose logging: set the <code>DL_USE_JSON=true</code> environment variable for structured logs</li>
<li class="">Join the <a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer" class="">OpenZiti Community</a> for support</li>
<li class="">Review your configuration against the complete example in the Configuration Reference section</li>
</ol></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/zrok/guides/self-hosting/interstitial-page/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Interstitial Pages</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/zrok/guides/self-hosting/organizations/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Organizations</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a><ul><li><a href="#whats-changing" class="table-of-contents__link toc-highlight">What&#39;s Changing</a></li><li><a href="#architecture-components" class="table-of-contents__link toc-highlight">Architecture Components</a></li></ul></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a><ul><li><a href="#installing-rabbitmq" class="table-of-contents__link toc-highlight">Installing RabbitMQ</a></li></ul></li><li><a href="#fresh-installation" class="table-of-contents__link toc-highlight">Fresh Installation</a><ul><li><a href="#step-1-create-dynamicproxycontroller-identity" class="table-of-contents__link toc-highlight">Step 1: Create dynamicProxyController Identity</a></li><li><a href="#step-2-create-ziti-service-and-policies" class="table-of-contents__link toc-highlight">Step 2: Create Ziti Service and Policies</a></li><li><a href="#step-3-configure-zrok-controller" class="table-of-contents__link toc-highlight">Step 3: Configure zrok Controller</a></li><li><a href="#step-4-create-a-namespace" class="table-of-contents__link toc-highlight">Step 4: Create a Namespace</a></li><li><a href="#step-5-create-a-dynamic-frontend" class="table-of-contents__link toc-highlight">Step 5: Create a Dynamic Frontend</a></li><li><a href="#step-6-map-namespace-to-frontend" class="table-of-contents__link toc-highlight">Step 6: Map Namespace to Frontend</a></li><li><a href="#step-7-configure-dynamicproxy-frontend" class="table-of-contents__link toc-highlight">Step 7: Configure dynamicProxy Frontend</a></li><li><a href="#step-8-start-dynamicproxy-frontend" class="table-of-contents__link toc-highlight">Step 8: Start dynamicProxy Frontend</a></li><li><a href="#step-9-test-with-a-share" class="table-of-contents__link toc-highlight">Step 9: Test with a Share</a></li></ul></li><li><a href="#migrating-from-publicproxy" class="table-of-contents__link toc-highlight">Migrating from publicProxy</a><ul><li><a href="#option-1-side-by-side-operation-gradual-migration" class="table-of-contents__link toc-highlight">Option 1: Side-by-Side Operation (Gradual Migration)</a></li><li><a href="#option-2-clean-cutover-with-downtime" class="table-of-contents__link toc-highlight">Option 2: Clean Cutover (With Downtime)</a></li><li><a href="#comparing-migration-approaches" class="table-of-contents__link toc-highlight">Comparing Migration Approaches</a></li></ul></li><li><a href="#configuration-reference" class="table-of-contents__link toc-highlight">Configuration Reference</a><ul><li><a href="#complete-configuration-example" class="table-of-contents__link toc-highlight">Complete Configuration Example</a></li></ul></li><li><a href="#namespace-management" class="table-of-contents__link toc-highlight">Namespace Management</a><ul><li><a href="#creating-namespaces" class="table-of-contents__link toc-highlight">Creating Namespaces</a></li><li><a href="#granting-namespace-access" class="table-of-contents__link toc-highlight">Granting Namespace Access</a></li><li><a href="#setting-default-namespace" class="table-of-contents__link toc-highlight">Setting Default Namespace</a></li><li><a href="#listing-namespaces" class="table-of-contents__link toc-highlight">Listing Namespaces</a></li></ul></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a><ul><li><a href="#frontend-not-receiving-mapping-updates" class="table-of-contents__link toc-highlight">Frontend Not Receiving Mapping Updates</a></li><li><a href="#frontend-cannot-query-controller-via-grpc" class="table-of-contents__link toc-highlight">Frontend Cannot Query Controller via gRPC</a></li><li><a href="#shares-dont-resolve-404-errors" class="table-of-contents__link toc-highlight">Shares Don&#39;t Resolve (404 Errors)</a></li><li><a href="#dns-not-resolving" class="table-of-contents__link toc-highlight">DNS Not Resolving</a></li><li><a href="#tls-certificate-errors" class="table-of-contents__link toc-highlight">TLS Certificate Errors</a></li><li><a href="#high-memory-usage" class="table-of-contents__link toc-highlight">High Memory Usage</a></li></ul></li><li><a href="#advanced-configuration" class="table-of-contents__link toc-highlight">Advanced Configuration</a><ul><li><a href="#multiple-frontend-instances" class="table-of-contents__link toc-highlight">Multiple Frontend Instances</a></li><li><a href="#custom-exchange-names" class="table-of-contents__link toc-highlight">Custom Exchange Names</a></li><li><a href="#monitoring-and-metrics" class="table-of-contents__link toc-highlight">Monitoring and Metrics</a></li></ul></li><li><a href="#additional-resources" class="table-of-contents__link toc-highlight">Additional Resources</a></li><li><a href="#getting-help" class="table-of-contents__link toc-highlight">Getting Help</a></li></ul></div></div></div></div></main></div></div><footer class="ozFooter_vn7r"><section class="footer_bja9 ozHorizontalSectionRoot_MqVF ozhsContent_Kh8Z"><div class="footerContainer_iBVG"><div class="footerGrid_Nk5d"><div class="footerColumn_pMZB"><h3>NetFoundry</h3><p>zrok is an open-source, self-hostable sharing platform that simplifies shielding and sharing network services or files.</p><div class="footerSocialLinks_fEp6"><a href="https://github.com/openziti/zrok" target="_blank" class="footerSocialLink_NibL" rel="noreferrer"><svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z"></path></svg></a><a href="https://www.linkedin.com/company/netfoundry/" target="_blank" class="footerSocialLink_NibL" rel="noreferrer"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.996 16V10.1C15.996 7.5 15.375 5.49999 12.025 5.49999C10.4 5.49999 9.325 6.39999 8.875 7.29999H8.825V5.79999H5.65V16H8.95V10.7C8.95 9.30001 9.2 7.9 10.925 7.9C12.65 7.9 12.675 9.59999 12.675 10.8V16H15.996Z"></path><path d="M0.25 5.79999H3.575V16H0.25V5.79999Z"></path><path d="M1.9 0C0.85 0 0 0.85 0 1.9C0 2.95 0.85 3.8 1.9 3.8C2.95 3.8 3.8 2.95 3.8 1.9C3.8 0.85 2.95 0 1.9 0Z"></path></svg></a><a href="https://youtube.com/netfoundry/" target="_blank" class="footerSocialLink_NibL" rel="noreferrer"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.969 4.69c-.183-1.358-1.062-2.275-2.361-2.46C12.371 2 8 2 8 2S3.629 2 2.362 2.229c-1.3.186-2.179 1.103-2.361 2.461C0 6.03 0 10 0 10s0 3.97.2 5.31c.183 1.358 1.062 2.275 2.361 2.46C3.63 18 8 18 8 18s4.371 0 5.638-.23c1.3-.185 2.178-1.102 2.361-2.46.2-1.34.2-5.31.2-5.31s0-3.97-.23-5.31zm-8.36, 8.57V6.73l3.76 2.27-3.76 2.26z"></path></svg></a><a href="https://twitter.com/netfoundry/" target="_blank" class="footerSocialLink_NibL" rel="noreferrer"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.996 3.038c-.59.262-1.219.44-1.885.52.677-.406 1.194-1.05 1.438-1.815-.634.375-1.337.648-2.085.795-.598-.638-1.45-1.038-2.396-1.038-1.813 0-3.283 1.469-3.283 3.282 0 .257.03.507.085.748-2.728-.137-5.147-1.445-6.766-3.43-.282.485-.444 1.05-.444 1.651 0 1.14.58 2.143 1.46 2.732-.538-.017-1.044-.164-1.487-.41v.04c0 1.59 1.13 2.918 2.633 3.219-.276.075-.567.116-.866.116-.211 0-.416-.021-.617-.06.418 1.304 1.63 2.254 3.066 2.28-1.124.883-2.539 1.406-4.077 1.406-.265 0-.526-.015-.785-.046 1.453.933 3.178 1.475 5.032 1.475 6.038 0 9.34-5.002 9.34-9.34 0-.142-.004-.284-.01-.425.641-.463 1.198-1.039 1.638-1.696"></path></svg></a></div></div><div class="footerColumn_pMZB"><h3>Documentation</h3><ul class="footerLinks_L73s"><li><a href="/docs/zrok/getting-started">Get started with zrok</a></li></ul></div><div class="footerColumn_pMZB"><h3>Community</h3><ul class="footerLinks_L73s"><li><a href="https://openziti.discourse.group/">Discourse Forum</a></li></ul></div><div class="footerColumn_pMZB"><h3>Resources</h3><ul class="footerLinks_L73s"><li><a href="https://blog.openziti.io">OpenZiti Tech Blog</a></li><li><a href="https://netfoundry.io/">NetFoundry</a></li></ul></div></div></div><div class="footerCopyright_MQh5"><p>© 2025 NetFoundry Inc. OpenZiti is an open source project sponsored by NetFoundry. All rights reserved.</p></div></section></footer></div></div>
</body>
</html>