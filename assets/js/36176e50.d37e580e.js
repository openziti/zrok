"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6240],{51561:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"guides/agent/remoting","title":"Agent Remoting","description":"As of v1.0.5 the zrok Agent and controller support secure, opt-in remote control for creating shares and accesses through the central zrok API.","source":"@site/../docs/guides/agent/remoting.mdx","sourceDirName":"guides/agent","slug":"/guides/agent/remoting","permalink":"/docs/guides/agent/remoting","draft":false,"unlisted":false,"editUrl":"https://github.com/openziti/zrok/blob/main/docs/../docs/guides/agent/remoting.mdx","tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"title":"Agent Remoting","sidebar_label":"Remoting","sidebar_position":20},"sidebar":"tutorialSidebar","previous":{"title":"Agent","permalink":"/docs/guides/agent/"},"next":{"title":"HTTP Health Checks","permalink":"/docs/guides/agent/http-healthcheck"}}');var r=t(74848),i=t(28453);const a={title:"Agent Remoting",sidebar_label:"Remoting",sidebar_position:20},l=void 0,s={},c=[{value:"Enabling Agent Remoting in the zrok Controller",id:"enabling-agent-remoting-in-the-zrok-controller",level:2},{value:"Enrolling an Agent",id:"enrolling-an-agent",level:2},{value:"The Agent Remoting API",id:"the-agent-remoting-api",level:2},{value:"Create A Remote Share",id:"create-a-remote-share",level:3},{value:"Query the Status of the Remote Agent",id:"query-the-status-of-the-remote-agent",level:3},{value:"Remove the Remote Share",id:"remove-the-remote-share",level:3},{value:"Creating and Removing Private Access",id:"creating-and-removing-private-access",level:3},{value:"Unenrolling an Agent",id:"unenrolling-an-agent",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["As of ",(0,r.jsx)(n.code,{children:"v1.0.5"})," the zrok Agent and controller support secure, opt-in remote control for creating shares and accesses through the central zrok API."]}),"\n",(0,r.jsx)(n.h2,{id:"enabling-agent-remoting-in-the-zrok-controller",children:"Enabling Agent Remoting in the zrok Controller"}),"\n",(0,r.jsx)(n.p,{children:"Create an identity for your zrok controller to use for interacting with remote agents:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ zrok admin create identity agentremoting\nzrok identity 'agentremoting' created with ziti id 'WEfGMIx-e4'\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["The indentity can be named anything; I chose ",(0,r.jsx)(n.code,{children:"agentremoting"})," just for this example."]})}),"\n",(0,r.jsx)(n.p,{children:"Next, you'll need to configure remoting in your controller config like this:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"agent_controller:\n  z_id:             WEfGMIx-e4\n  identity_path:    /home/michael/.zrok/identities/agentremoting.json\n"})}),"\n",(0,r.jsx)(n.p,{children:"Restart your controller with this configuration and the agent remoting endpoints will become available."}),"\n",(0,r.jsx)(n.h2,{id:"enrolling-an-agent",children:"Enrolling an Agent"}),"\n",(0,r.jsxs)(n.p,{children:["Enrolling an Agent in remoting requires an enabled environment. You can use the ",(0,r.jsx)(n.code,{children:"zrok agent enroll"})," command from an enabled environment to enroll your agent:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ zrok agent enroll\n\nwarning! proceeding will allow remote control of your zrok agent!\n\nyour agent will accept remote commands from:\n\nhttps://api-v1.zrok.io\n\nyou should only proceed if you understand the implications of this action!\n\nto proceed, type 'yes': yes\n\nagent enrolled with token 'yC9atRbCOskz'\n\nrestart your zrok agent to enable remote control\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"When you restart your agent, you will notice the following message in the Agent's log:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[   0.001]    INFO zrok/agent.(*Agent).remoteAgent: listening for remote commands at 'yC9atRbCOskz'\n"})}),"\n",(0,r.jsx)(n.h2,{id:"the-agent-remoting-api",children:"The Agent Remoting API"}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["See the ",(0,r.jsx)(n.a,{href:"https://github.com/openziti/zrok/blob/main/specs/zrok.yml",children:"zrok OpenAPI spec"})," for complete details of ",(0,r.jsx)(n.code,{children:"/agent"})," endpoints."]})}),"\n",(0,r.jsx)(n.h3,{id:"create-a-remote-share",children:"Create A Remote Share"}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"apiEndpoint"})," ",(0,r.jsx)(n.code,{children:"http://localhost:18080"})," is a zrok controller in a local development environment. All of the credentials in this document are local to that instance and already invalid as of publication of this document. It's just an example."]})}),"\n",(0,r.jsxs)(n.p,{children:["You can call the ",(0,r.jsx)(n.code,{children:"/agent/share"})," endpoint to create a share on a remote Agent through the API:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'$ curl -H "X-TOKEN: ojF2fna5GKlt" -XPOST -H "Content-Type: application/zrok.v1+json" -d \'{"envZId": "qDWmgIxne4", "shareMode": "public", "backendMode": "web", "target": "/home/michael/Repos/nf/zrok"}\' http://localhost:18080/api/v1/agent/share | jq\n{\n  "frontendEndpoints": [\n    "http://51bnatug7ua3.zrok.quigley.com:8080"\n  ],\n  "token": "51bnatug7ua3"\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"query-the-status-of-the-remote-agent",children:"Query the Status of the Remote Agent"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'$ curl -H "X-TOKEN: ojF2fna5GKlt" -XPOST -H "Content-Type: application/zrok.v1+json" -d \'{"envZId": "qDWmgIxne4"}\' http://localhost:18080/api/v1/agent/status | jq\n{\n  "accesses": null,\n  "shares": [\n    {\n      "backendEndpoint": "/home/michael/Repos/nf/zrok",\n      "backendMode": "web",\n      "frontendEndpoints": [\n        "http://51bnatug7ua3.zrok.quigley.com:8080"\n      ],\n      "shareMode": "public",\n      "token": "51bnatug7ua3"\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"remove-the-remote-share",children:"Remove the Remote Share"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'$ curl -H "X-TOKEN: ojF2fna5GKlt" -XPOST -H "Content-Type: application/zrok.v1+json" -d \'{"envZId": "qDWmgIxne4", "token": "51bnatug7ua3"}\' http://localhost:18080/api/v1/agent/unshare\n\n$ curl -H "X-TOKEN: ojF2fna5GKlt" -XPOST -H "Content-Type: application/zrok.v1+json" -d \'{"envZId": "qDWmgIxne4"}\' http://localhost:18080/api/v1/agent/status | jq\n{\n  "accesses": null,\n  "shares": null\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"creating-and-removing-private-access",children:"Creating and Removing Private Access"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"/agent/access"})," and ",(0,r.jsx)(n.code,{children:"/agent/unaccess"})," endpoints also exist and allow for creating and removing private access frontends remotely."]}),"\n",(0,r.jsx)(n.h2,{id:"unenrolling-an-agent",children:"Unenrolling an Agent"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"zrok agent unenroll"})," command will remove all remote control access from an Agent in an environment:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ zrok agent unenroll\nSUCCESS: unenrolled agent from 'https://api-v1.zrok.io'\nSUCCESS: removed agent-enrollment.json\n"})}),"\n",(0,r.jsx)(n.p,{children:"Unenrolling an agent currently enrolled in remoting will result in (ignorable) agent errors. Restart your agent to resume unenrolled operation."})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>l});var o=t(96540);const r={},i=o.createContext(r);function a(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);